---
title: "SUN"
author: "Yueran SUN"
format: html
---

## Setup


```{r}

here::i_am("grades-lab.Rproj")
library(here)
library(tidyverse)
library(ggplot2)

```


## Question 1

```{r}

courses <- read_csv(here("data","courses.csv"))

```

## Question 2


```{r}

sorted_courses <- courses[order(courses$course), ]

column_names_english <- c("Course Name", "Identifier", "Module", "Number of Exams")

knitr::kable(
  sorted_courses, 
  col.names = column_names_english, 
  caption = "Course List"
)

```

## Question 3

```{r}

students <- read_csv(here("data", "students.csv"),
                     col_types = cols(
                       birth_date = col_date(),
                       sex = col_factor()
                     )
)

```


## Question 4

```{r}

grades <- read_delim(here("data", "grades.csv"), 
                     delim = ";",
                     na = "$")

```

## Question 5

```{r}

students |> ggplot()+geom_bar(aes(x = group))

```

## Question 6 

```{r}

ggplot(students, aes(x = group, fill = sex)) + geom_bar(position = "fill") +
    labs(
    x = "Student Group",
    y = "Number of Students",
    fill = "Gender"
  )

```

## Question 7

```{r}

library(lubridate)

students|>
  mutate(age = time_length(today() - birth_date, unit="year"))|>
  mutate(age = round(age)) -> students

students |> ggplot()+geom_bar(aes(x = age))



```

## Question 8 

```{r}

library(knitr)

median_age_by_group <- students |>
  group_by(group) |>
    summarise(
    median_age = round(median(age, na.rm = TRUE)) 
  )

kable(
  median_age_by_group, 
  col.names = c("Group", "Median Age (Years)"), 
  caption = "Median Student Age by Group"
)

#Updating kable did not remove the warning

```

## Question 9 

```{r}

oldest_students <- students |>
  group_by(group) |>
  filter(row_number(desc(age)) == 1) |>
  select(id, sex, age, group) |>
  arrange(desc(age)) |>
  ungroup()

kable(
  oldest_students, 
  col.names = c("Student ID", "Gender", "Age (Years)", "Group"), 
  caption = "Oldest Student in Each Group"
)

```

## Question 10 

The data set contains `r sum(!is.na(grades$grades))` grades.

## Question 11


Compute the average of all the grades in Warfare and Diplomacy in each group and display
graphically this average as a function of the group. It is recommend to use geom_col() for this task.

```{r}

grades_students <- grades|>
  left_join(students, by = "id")

grades_students_courses <- grades_students|>
  left_join(courses, by = "course_id")

grades_students_courses|>
  filter(course == "Warfare and Diplomacy")|>
  group_by(group)|>
  summarize(mean_grade = mean(grade, na.rm = TRUE))|>
  ggplot(aes(x = group, y = mean_grade))+geom_col()


```

## Question 12

```{r}

grades_students_courses|>
  drop_na()|>
  ggplot(aes(x = as.factor(module), y = grade, fill = as.factor(module))) +
  geom_violin() +
  labs(
    title = "Distribution of Grades Across Modules",
    x = "Module",
    y = "Grades",
    fill = "Module"
  ) 

```

## Question 13


```{r}

gradesperstudent <- grades_students_courses %>%
  group_by(id, group, sex) %>%
  summarise(
    nb_grades = sum(!is.na(grade)),
    min_grade = min(grade, na.rm = TRUE),
    max_grade = max(grade, na.rm = TRUE),
    avg_grade = mean(grade, na.rm = TRUE),
    median_grade = median(grade, na.rm = TRUE),
    .groups = 'drop'
  ) %>%
  select(id, group, sex, nb_grades, min_grade, max_grade, avg_grade, median_grade)

```

The summary statistics for the number of grades per student are presented in the table below:

`r gradesperstudent %>% summarise(Minimum = min(nb_grades), Maximum = max(nb_grades), Average = mean(nb_grades), Median = median(nb_grades)) %>% kable(caption = "Summary Statistics for Number of Grades per Student", col.names = c("Minimum Grades", "Maximum Grades", "Average Grades", "Median Grades"), format = "markdown", digits = 2)`


